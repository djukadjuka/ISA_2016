<!-- Filtering restaurants -->
<button pButton type="button" class="ui-button-secondary" label="Filter restaurants" style="margin-bottom: 15px" icon="fa fa-filter" (click)="showFilterDialog=true"></button>
<button *ngIf="showFilterCancelButton" pButton type="button" class="ui-button-danger" pTooltip="Cancel filter" tooltipPosition="bottom" style="margin-bottom: 15px" icon="fa-times" (click)="cancelFilter()"></button>
<div *ngIf="showFilterCancelButton">
    <p> Showing results for: </p>
    <p *ngIf="filterData.restaurantName.trim() != ''"> Name containing: <b>{{filterData.restaurantName.trim()}} </b></p>
    <p *ngIf="filterData.restaurantType != ''"> Type of restaurant: <b>{{filterData.restaurantType}} </b></p>
</div>

<p-growl [value]="growl"></p-growl>

<p-dialog header="Filter restaurants" [responsive]=true [resizable]=false [draggable]=false width="500" [modal]=true [(visible)]="showFilterDialog">
    <h3>Filtering info</h3>
    <form [formGroup]="formFilter" class="form-horizontal">
      <div class="form-group">
        <div class="col-md-12">
          <label class="control-label">Restaurant name (contains):</label>
          <input class="form-control" formControlName="restaurantName" [(ngModel)]="filterData.restaurantName" type="text">
        </div>
      </div>
      <div class="form-group">
          <div class="col-md-12">
            <label class="control-label">Type of restaurant:</label>
            <select name="role" class="form-control" formControlName="restaurantType" [(ngModel)]="filterData.restaurantType">
                <option [value]="" selected></option>
                <option *ngFor="let type of restaurantTypes" [value]="type.value">  
                {{type.label}}
                </option>
            </select>
          </div>
      </div>
      <div class="form-group">
        <label class="col-md-3 control-label"></label>
        <div class="col-md-8">
          <button pButton [disabled]="!formFilter.valid" class="ui-button-success" type="text" (click)="filterRestaurants()" icon="fa-check" label="Apply filter"></button>
          <span></span>
          <button pButton class="ui-button-danger" type="text" (click)="showFilterDialog=false" icon="fa-close" label="Cancel"></button>
        </div>
      </div>
    </form>
</p-dialog>

<!--DATA GRID OF ALL RESTAURANTS-->
<!--Shown if the user is not editing a restaurant-->
<!--8 Items per page-->
<p-dataGrid *ngIf="!editing && !editingZones" [value]="restaurants" [paginator]="true" [rows]="8">
    
    <!--Datagrid header-->
    <header>
        List of Restaurants
    </header>
    
    <!--Datagrid data template-->
    <template let-restaurant pTemplate="item">

        <!--Style of one cell in the datagrid-->
        <div style="padding:3px" class="ui-g-12 ui-md-3">
            <p-panel [header]="restaurant.name" [style]="{'text-align':'center'}">
                <img [src]="restaurant.image" (error)="restaurant.image = '/assets/pictures/no_image_found.jpg'" width="150" height="150">
                
                <!--QUICK DETAILS-->
                <hr class="ui-widget-content" style="border-top:0">
                <div class="restaurant-detail">

                    <!--Type of restaurant-->
                    <b>Type : </b><i>{{restaurant.type}}</i><br/>
                    <hr class="ui-widget-content" style="border-top:0">

                    <!--Food types-->
                    <b>Serves : </b><br/>
                    <div *ngIf="restaurant.foodTypes.length == 0">
                        <i>None specified ...</i><br/><br/><br/><br/>
                    </div>
                    <div *ngIf="restaurant.foodTypes.length > 0">
                        <template ngFor let-foodtype="$implicit" [ngForOf]="restaurant.foodTypes" let-i="index">
                            <template [ngIf]="i<3">
                                <i>{{foodtype.name}}</i><br/>
                            </template>
                            <template [ngIf]="i==2 && restaurant.foodTypes.length > 2">
                                <i>And Many More ...</i>
                            </template>
                        </template>
                    </div>
                    
                </div>
                <!-- REPLACE IF NOT A GOOD MANAGER-->
                <hr class="ui-widget-content" style="border-top:0">
                <button style="width:100%" pButton type="button" label="Edit Restaurant" 
                        icon="fa-edit" (click)="editRestaurant(restaurant)">
                        </button><br/>
                <button style="width:100%" pButton type="button" label="Edit Zones" 
                        icon="fa-edit" (click)="editZones(restaurant)">
                        </button><br/>
                <button style="width:100%" pButton type="button" label="Change Image"
                        icon="fa-image" (click)="showUploadImageDialog(restaurant.id)"> 
                        </button><br/>
                
            </p-panel>
        </div>
    </template>
</p-dataGrid><br/>

<!--IMAGE UPLOAD DIALOG-->
<p-dialog   header="Upload Picture" [responsive]=true 
            [resizable]=false [draggable]=false width="500" height="500"
            [modal]=true [(visible)]="uploadingPicture">
    
    <p-fileUpload name="file" url="http://localhost:4400/uploadImage" (onUpload)="uploadImageBaby($event)" 
        accept="image/*" maxFileSize="1000000" (onBeforeSend)="beforeSend($event)" (onSelect)="beforeUpload($event)"> 
    </p-fileUpload>

</p-dialog>

<!--EDIT RESTAURANT ZONES PANEL -->
<p-panel *ngIf="editingZones">
    <p-header >

        <!--PANEL TOOLBAR WITH SAVE CANCEL BUTTONS -->
        <div class="ui-helper-clearfix">
            <span class="ui-panel-title"><h4>{{editingDialogHeader}}</h4></span>
            <button pButton type="button" label='Close' icon='fa-close' (click)="closeZonePanel()"></button>
        </div>
    </p-header>

    <p-dataTable    [value]="restaurantZones" selectionMode="single" 
                    [(selection)]="selectedZone" (onRowSelect)="zoneSelected($event)" 
                    [paginator]="true" rows="15" [responsive]="true">
        <p-header>Zones</p-header>
        <p-column field="id" header="Zone ID"></p-column>
        <p-column field="name" header="Name"></p-column>
        <p-column field="tables_for_x" header="Tables For"></p-column>
        <p-column field="number_of_tables" header="Number of Tables"></p-column>
        <p-footer *ngIf="!addingZone && !editingZone">
            <div class="ui-helper-clearfix" style="width:100%">
                <button  type="button" pButton icon="fa-plus" 
                        style="float:left" (click)="addNewZone()" 
                        label="Add Zone"></button>
            </div>
        </p-footer>
    </p-dataTable><br/>

    <!--PANEL FOR CRUD INITIATION-->
    <p-panel *ngIf="zoneCrud">
        <div class="ui-g">

            <!--ZONE NAME-->
            <div class="ui-g-4">
                <b>Zone name : </b>
            </div>
            <div class="ui-g-8">
                <p-selectButton [options]="zoneNames" [(ngModel)]="selectedZoneName"></p-selectButton>
            </div>

            <!--ZONE TABLES FOR X-->
            <div class="ui-g-4">
                <b>Tables for : </b>
            </div>
            <div class="ui-g-4">
                <!--INPUT-->
                <input type="text" pInputText [(ngModel)]="tablesForX" (keyup)="enteredTablesForX()"/>
            </div>
            <div class="ui-g-4">
                <!--ERROR-->
                <div class="ui-message ui-messages-error ui-corner-all" *ngIf="!tablesForXValid">
                    <i class="fa fa-close"></i>
                    <span>Invalid input!</span>
                </div>
            </div>

            <!--ZONE NUMBER OF TABLES-->
            <div class="ui-g-4">
                <b>Number of tables : </b>
            </div>
            <div class="ui-g-4">
                <!--INPUT-->
                <input type="text" pInputText [(ngModel)]="numberOfTables" (keyup)="enteredNumberOfTables()"/>
            </div>
            <div class="ui-g-4">
                <!--ERROR-->
                <div class="ui-message ui-messages-error ui-corner-all" *ngIf="!numberOfTablesValid">
                    <i class="fa fa-close"></i>
                    <span>Invalid input!</span>
                </div>
            </div>
        </div>

        <!--BUTTONS FOOTER-->
        <p-footer>
            <div *ngIf="addingZone" class="ui-helper-clearfix" style="width:100%">
                    <button pButton type="button" icon="fa-plus" 
                            (click)="confirmAdd()" 
                            label="Add Zone" [disabled]="!numberOfTablesValid || !tablesForXValid"></button>
                    <button pButton type="button"
                            (click)="cancelCrud()" label="Cancel"></button> 
            </div>
            <div *ngIf="editingZone" class="ui-helper-clearfix" style="width:100%">
                    <button pButton type="button" icon="fa-check"
                             (click)="confirmEdit()" label="Save" [disabled]="!numberOfTablesValid || !tablesForXValid"
                            ></button>
                    <button pButton type="button" icon="fa-trash"
                            (click)="deleteZone()" label="Delete Zone"></button>
                    <button pButton type="button"
                            (click)="cancelCrud()" label="Cancel"></button> 
            </div>
        </p-footer>

    </p-panel>
</p-panel>


<!--EDITING RESTUAURANT PANEL-->
<p-panel *ngIf="editing">

    <!--PANEL HEADER-->
    <p-header [style]="{'text-align':'center'}">

        <!--PANEL TOOLBAR WITH SAVE CANCEL BUTTONS -->
        <div class="ui-helper-clearfix">
            <span class="ui-panel-title"><h4>{{editingDialogHeader}}</h4></span>
            <p-splitButton [style]="{'float':'right'}" label='Save Changes' icon='fa-check' (onClick)="saveUpdate()" [model]="splitButtonCommands"></p-splitButton>
        </div>
    </p-header>

    <!--TABS DEFINITION AND CONTENT FOR EDITING RESTAURANT-->
    <p-tabView>

        <!--BASIC RESTAURANT INFORMATION-->
            <!--name of restaurant and type of restaurant-->
        <p-tabPanel header="Basic Information">
            <div class="container-fluid">

                <!--ROW FOR NAME AND RESTAURANT TYPE-->
                <hr/>
                <div class="row">
                    <div class="col-md-6">
                        <b>Name :</b> <input type="text" pInputText [(ngModel)]="editingRestaurant.name"/><br/>
                    </div>
                    <div class="col-md-6">
                        <b>Type :</b> <p-selectButton [options]="restaurantTypes" [(ngModel)]="editingRestaurant.type"></p-selectButton><br/>
                    </div>
                </div><hr/>

                <!--ROW FOR FOOD TYPES AND IMAGE -->
                <div class="row">
                    <div class= col-md-6>
                        <b>Available Cuisines:</b>
                            <p-listbox  [options]="availableCuisines" [(ngModel)]="selectedCuisines"
                                        (onChange)="showChange()" 
                                        multiple="multiple" checkbox="checkbox"></p-listbox>
                    </div>
                    <div class= col-md-6>
                        <b>Restaurant picture:</b><br/>
                        <img [src]="editingRestaurant.image" (error)="editingRestaurant.image = '/assets/pictures/no_image_found.jpg'" alt="..." height="150" width="150"/><br/>
                        <b>Upload new:</b><br/>
                        <!-- url="http://localhost:4400/restaurantPictureUpload"-->
                        <i>Work in progress....</i>
                    </div>
                </div>

            </div>
        </p-tabPanel>

        <!--PRODUCT INFORMATION-->
            <!--List of all available food and drink items that the restaurant can serve-->
            <!--And a list of currently selected food and drink items-->
        <p-tabPanel header="Food and Drinks">

            <!--FOOD PICKLIST-->
            <p-pickList [source]="availableFood" [target]="selectedFood"
                        [showSourceControls]="false" [showTargetControls]="false"
                        [sourceStyle]="{'height':'300px'}" [targetStyle]="{'height':'300px'}" 
                        [responsive]="true"
                        sourceHeader="Available Food" targetHeader="Selected Food">
                <template let-product pTemplate="item">
                    <div class="media">
                        <div class="media-left">
                            <img class="media-object" src="http://lorempixel.com/100/100/food/?">
                        </div>
                        <div class="media-body">
                            <h4 class="media-heading">{{product.name}}</h4>
                            <b>Price :</b> <i>{{product.price}} &#36;</i><br/>
                            <b>Description :</b> <i>{{product.description}}</i>
                        </div>
                    </div><hr/>
                </template>
            </p-pickList><br/>

            <!--DRINK PICKLIST-->
            <p-pickList [source]="availableDrinks" [target]="selectedDrinks" 
                        [showSourceControls]="false" [showTargetControls]="false" 
                        [sourceStyle]="{'height':'300px'}" [targetStyle]="{'height':'300px'}" 
                        [responsive]="true"
                        sourceHeader="Available Drinks" targetHeader="Selected Drinks">
                <template let-product pTemplate="item">
                    <div class="media">
                        <div class="media-left">
                           <img class="media-object" src="http://lorempixel.com/100/100/food/?">
                        </div>
                        <div class="media-body">
                            <h4 class="media-heading">{{product.name}}</h4>
                            <b>Price :</b> {{product.price}} &#36;<br/>
                            <b>Description :</b> {{product.description}}
                        </div>
                    </div><hr/>
                </template>
            </p-pickList><br/>
        </p-tabPanel>
    </p-tabView>

</p-panel>